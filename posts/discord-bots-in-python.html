<!DOCTYPE html>
<html lang="en" data-theme="dark">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>zmudzinski.sh</title>
        <meta name="description" content="I write Python code and do nerdy things.">
        <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
        <link rel="stylesheet" href="https://zmudzinski.sh/theme/css/code.css" />
        <link rel="stylesheet" href="https://zmudzinski.sh/theme/css/page.css" />
        <link rel="icon" href="/favicon.ico">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
        <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="manifest" href="/site.webmanifest">
    </head>
    <body class="bg-neutral-950 text-neutral-100 font-mono">
        <main role="main">
            <div class="container max-w-4xl mx-auto px-4 sm:px-6 md:px-8">
<h1 class="text-4xl mt-20"><a href="https://zmudzinski.sh">zmudzinski.sh</a></h1>
<h2 class="text-sm text-neutral-500">I write Python code and do nerdy things.</h2>

<ul class="mt-5 flex space-x-4">
    <li><a class="underline" href="https://zmudzinski.sh">Posts</a></li>
    <li><a class="underline" href="https://zmudzinski.sh/pages/about">About</a></li>
</ul><article class="prose prose-invert font-mono max-w-4xl mt-20">
    <h1>Discord bots in Python</h1>
    <h2 class="text-sm text-neutral-500 -mt-6 mb-10">Created on: 2021.05.20</h2>
    <p>In the last couple of years, we have experienced a shift in the way people work and study. We can see this movement on the job market - many offers related to IT are tagged 100% remote, allowing people to work with peers from all around the world. This is why such applications as Slack, Microsoft Teams, or Discord increased in popularity and are used by many people on a daily basis. Today we will focus on Discord - a means of communication that rose from a gaming tool to a platform that is used by professionals, educators, and communities.</p>
<p>The more co-workers use your tool, the bigger responsibility you have to keep everything in line. You can either hire more and more moderators&hellip; or you could use the tech knowledge your developer team has to create bots that will do the dirty work for you. In this blog post, I will go through the necessary knowledge to create and run a Discord bot that will communicate with external APIs to provide information on demand.</p>
<p>After reading through this tutorial, you will learn a few tactics useful for having more effective online communications in Discord:</p>
<ul>
<li>How to create a Discord bot,</li>
<li>How to access information about the server,</li>
<li>How to contact external services using commands,</li>
<li>How to create Embeds.</li>
</ul>
<h2>Requirements</h2>
<p>To get the most out of this tutorial, I encourage you to complete the following steps:</p>
<ol>
<li>Python 3.10 (you can use a lower version, if you want to skip match-case),</li>
<li><a href="https://discord.com/register">Create a Discord account</a>,</li>
<li><a href="https://support.discord.com/hc/en-us/articles/204849977-How-do-I-create-a-server-">Create a test server</a>,</li>
<li>Get ready for a coding adventure!</li>
</ol>
<h2>Understanding the connection</h2>
<p>Before we start coding, let's take a minute to understand how the communication works between your team server, Discord, your bot, and any other services you want to use.</p>
<p>Everything starts with your team server - this is how people interact with each other and artificial entities like bots. Each interaction can trigger the bot to do something - it can be done by special commands or an event sent by the server. Sample events can include:</p>
<ul>
<li>Sending a message by a user,</li>
<li>New member joining the server,</li>
<li>Creating a new channel,</li>
<li>and many&hellip; many more!</li>
</ul>
<p>If a bot is connected to your team server, it will try to handle events that are of interest to it.</p>
<p><strong>Each bot needs to have a running Discord Client instance. This is how the bot contacts Discord servers and APIs to answer the team server requests.</strong></p>
<p>It is worth mentioning that a single bot can be connected to multiple servers. You can select, if you want that feature in the Discord bots’ settings (more about that later on).</p>
<p>Once the bot processes information sent by the team server, it can contact multiple external services for example:</p>
<ul>
<li>Your application Rest API,</li>
<li>Machine Learning algorithms,</li>
<li>Your company ERP system,</li>
<li>and anything else that comes to mind!</li>
</ul>
<p>Lastly, the information can be sent by the bot to the Discord API, so that the users are notified back on the event progress.</p>
<h2>Getting started</h2>
<p>We will start by creating a Discord Application. This step is needed to enable Discord to verify your bot with the servers through a token you will acquire in the process. As a bonus, you will get a chance to customize your bot's appearance.</p>
<p>Go to your <a href="https://discord.com/login?redirect_to=%2Fdevelopers%2Fapplications">Discord Developer dashboard</a> and click <strong>New Application</strong>.</p>
<p><img alt="Create an application" src="https://zmudzinski.sh/posts/creating-a-new-discord-application.png" /></p>
<p>Congratulations! You created your first Discord Application 🥳. You will be welcomed by a screen that will allow you some customization. You can play around with the settings, but it isn't required for this tutorial.</p>
<p>In the menu section, you should see a button named <strong>Bot</strong>, please navigate to that section, once there, press <strong>Add Bot</strong> and agree to the prompt.</p>
<p>Turn on the following privileged gateway intents and click <strong>Save</strong>:</p>
<ul>
<li>Presence intent,</li>
<li>Server members intent,</li>
<li>Message content intent.</li>
</ul>
<p>Now that you created the bot, please go to the OAuth2 section and select URL Generator:</p>
<ul>
<li>Set the bot scope,</li>
<li>Set the Administrator permission.</li>
<li>Copy the Generated URL.</li>
</ul>
<p><img alt="Bot scope" src="https://zmudzinski.sh/posts/setting-the-bot-scope-and-administrator-permissions-in-discord.png" /></p>
<p>Follow the copied url in a browser and add the bot to your server. We are ready to build our own piece of software now!</p>
<h2>And then there was code…</h2>
<p>In this section, we will go through the steps of installing dependencies, configuring the project and writing the actual code. Please start your IDE of choice and create a new project.</p>
<h3>Installing dependencies</h3>
<p>We will need the following packages to create our Discord bot:</p>
<ul>
<li><code>discord.py</code> - the main package needed to communicate with Discord,</li>
<li><code>requests</code> - this will allow us to contact the sample API,</li>
<li><code>dotenv</code> - to load environment variables from a file.</li>
</ul>
<p>First, create a new virtual environment to be used in this tutorial (if you don't know what virtual environments are, be sure to check out <a href="https://docs.python.org/3/library/venv.html">Python documentation for creating virtual environments</a>):</p>
<div class="codehilite"><pre><span></span><code>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv
<span class="nb">source</span><span class="w"> </span>.venv/bin/activate
</code></pre></div>

<p>Now we are ready to install the dependencies:</p>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>discord.py
pip<span class="w"> </span>install<span class="w"> </span>requests
pip<span class="w"> </span>install<span class="w"> </span>python-dotenv
</code></pre></div>

<h3>Project settings</h3>
<p>We will start by creating an <code>.env</code> file (notice the "dot" at the start) in our project directory. We will make use of the token you copied from the Discord Developers site and the name of the server you created in the requirements for this tutorial.</p>
<div class="codehilite"><pre><span></span><code>DISCORD_TOKEN = your_token_goes_here
DISCORD_GUILD = your_server_name
</code></pre></div>

<p>Looks good! We are ready for the next step.</p>
<h3>Connecting the Discord client</h3>
<p>Create a <code>main.py</code> file in the project directory and add the necessary imports that we will be using in this tutorial at the top:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="kn">import</span> <span class="nn">discord</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</code></pre></div>

<p>Now, we will read the environment variables we added in the configuration file:</p>
<div class="codehilite"><pre><span></span><code><span class="n">load_dotenv</span><span class="p">()</span>

<span class="n">DISCORD_TOKEN</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DISCORD_TOKEN&quot;</span><span class="p">)</span>
<span class="n">DISCORD_GUILD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DISCORD_GUILD&quot;</span><span class="p">)</span>
</code></pre></div>

<p>The next step is to create the Discord client. We will make it fairly simple for now:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Client</span><span class="p">(</span><span class="n">discord</span><span class="o">.</span><span class="n">Client</span><span class="p">):</span>
   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">guild_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
       <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="n">token</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guild_name</span> <span class="o">=</span> <span class="n">guild_name</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_token</span><span class="p">)</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">DISCORD_TOKEN</span><span class="p">,</span> <span class="n">DISCORD_GUILD</span><span class="p">)</span>
        <span class="n">client</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>

<p>The code we just added gave us three outcomes:</p>
<ul>
<li>We created a <code>Client</code> class that inherits from the <code>discord.Client</code>,</li>
<li>We stored the settings in the class parameters,</li>
<li>We started our client using the run function.</li>
</ul>
<p>If you run the <code>main.py</code> file, you should see the bot online on your server.</p>
<p><img alt="Bot online" src="https://zmudzinski.sh/posts/bot-on-the-server-upon-running-the-mainpy-file.png" /></p>
<h2>Gathering basic information</h2>
<p>The <code>discord.py</code> package gives us quite a few possibilities out of the box. We will start by creating an action when the bot goes online. Let's create a new function in the <code>Client</code> class:</p>
<div class="codehilite"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">on_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">_guild</span> <span class="o">=</span> <span class="n">discord</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">guilds</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_guild_name</span><span class="p">)</span>
   <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guild</span><span class="o">.</span><span class="n">text_channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Hello World!&quot;</span><span class="p">)</span>
</code></pre></div>

<p>We used the discord utils to get the guild by the name and sent a message to the main text channel. The next time you start your Python file, you should get an output like this:</p>
<p><img alt="Bot online" src="https://zmudzinski.sh/posts/python-file-output-message.png" /></p>
<h2>Gathering information for the user</h2>
<p>A command is a special message that the user can send to perform various bot tasks. We will start by creating a command that lists users that are currently online.</p>
<p>If you want to gather information about the users, we need to update the <code>__init__</code> function a bit. Be sure to add the following intent to the <code>Client</code> constructor:</p>
<div class="codehilite"><pre><span></span><code><span class="n">intents</span> <span class="o">=</span> <span class="n">discord</span><span class="o">.</span><span class="n">Intents</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
<span class="n">intents</span><span class="o">.</span><span class="n">members</span> <span class="o">=</span> <span class="kc">True</span>
<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">intents</span><span class="o">=</span><span class="n">intents</span><span class="p">)</span>
</code></pre></div>

<p>We will override the default on_message to make it easier. If you want to go advanced, you can read about the <a href="https://discordpy.readthedocs.io/en/latest/ext/commands/index.html">bot commands framework</a>.</p>
<div class="codehilite"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">discord</span><span class="o">.</span><span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
   <span class="k">match</span> <span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
       <span class="k">case</span> <span class="s2">&quot;!members&quot;</span><span class="p">:</span>
           <span class="n">members</span> <span class="o">=</span> <span class="p">[</span><span class="n">member</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guild</span><span class="o">.</span><span class="n">members</span><span class="p">]</span>
           <span class="k">await</span> <span class="n">message</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Members: </span><span class="si">{</span><span class="n">members</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Please notice that instead of displaying <em>"Łukasz"</em> the bot responded with <em>"Divinebanana"</em>. While confusing, the reason is that Łukasz is a nickname specific to this server. If you want to obtain the server user nickname instead, you should use <code>member.nick</code> instead of <code>member.name</code>.</p>
<h2>Connecting to external services</h2>
<p>The greatest thing about Discord bots is that you are only limited to the programming language capabilities. I will show you how to contact a REST API through a bot command and then display the information in an embed, making it pretty.</p>
<p>First of all, let's add a new command to our <code>match</code> in <code>on_message</code> function:</p>
<div class="codehilite"><pre><span></span><code><span class="k">match</span> <span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
   <span class="k">case</span> <span class="s2">&quot;!members&quot;</span><span class="p">:</span>
       <span class="o">....</span>

   <span class="k">case</span> <span class="s2">&quot;!highground&quot;</span><span class="p">:</span>
       <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_ground</span><span class="p">()</span>
</code></pre></div>

<p>Now, we just need to create the <code>high_ground</code> function in our <code>Client</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">high_ground</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
   <span class="k">try</span><span class="p">:</span>
       <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://swapi.dev/api/people/10/&quot;</span><span class="p">)</span>
       <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
       <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
   <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span>
       <span class="k">return</span>

    <span class="n">embed</span> <span class="o">=</span> <span class="n">discord</span><span class="o">.</span><span class="n">Embed</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
    <span class="n">description</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">embed</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Height&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">))</span>
    <span class="n">embed</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Mass&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mass&quot;</span><span class="p">))</span>
    <span class="n">embed</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Hair Color&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hair_color&quot;</span><span class="p">))</span>
    <span class="n">embed</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Birth Year&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;birth_year&quot;</span><span class="p">))</span>
    <span class="n">embed</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Eye Color&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;eye_color&quot;</span><span class="p">))</span>
    <span class="n">embed</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Gender&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gender&quot;</span><span class="p">))</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_guild</span><span class="o">.</span><span class="n">text_channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">embed</span><span class="o">=</span><span class="n">embed</span><span class="p">)</span>
</code></pre></div>

<p>We contacted the <a href="https://swapi.dev/">Star Wars API</a> to gather information about Obi-Wan Kenobi, a Jedi Master and one of the greatest Jedi Generals during the Clone Wars. We also used another cool feature of Discord - Embeds. You can see the result of our operations below.</p>
<p><img alt="Embed" src="https://zmudzinski.sh/posts/creating-embeds-in-discord.png" /></p>
<p>Embeds allow you to create rich objects that can contain media and data condensed in a structured fashion. Feel free to read more about Embeds in the <a href="https://discord.com/developers/docs/resources/channel#embed-object">official Discord documentation</a>.</p>
<h2>Summary</h2>
<p>With the increased usage of online communication  tools like bots can increase your productivity for small and large-scale communities, whether it is work, education or hobby-related. As you could see, building such applications is not hard and can power up your server for you and your users.</p>
<p>If you want to learn more, be sure to check the links below:</p>
<ul>
<li><a href="https://discord.com/developers/docs/intro">Discord documentation</a> - all things related to the Discord Developer API,</li>
<li><a href="https://github.com/Rapptz/discord.py">discord.py code repository</a> with the code repository for the package,</li>
<li><a href="https://discordpy.readthedocs.io/en/latest/">discord.py documentation</a> - the documentation for the package.Thanks for reading!</li>
</ul>
<p>Thanks for reading!</p>
</article>
<footer class="mt-20 mb-20 text-sm text-neutral-500">
    &copy; 2025 zmudzinski.sh - from Poland with code.
</footer>            </div>
        </main>
    </body>
</html>