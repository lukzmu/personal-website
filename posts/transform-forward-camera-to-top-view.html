<!DOCTYPE html>
<html lang="en" data-theme="dark">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>zmudzinski.me</title>
        <meta name="description" content="I write Python code and do nerdy things.">
        <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
        <link rel="stylesheet" href="https://zmudzinski.me/theme/css/code.css" />
        <link rel="stylesheet" href="https://zmudzinski.me/theme/css/page.css" />
        <link rel="icon" href="/favicon.ico">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
        <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="manifest" href="/site.webmanifest">
    </head>
    <body class="bg-neutral-950 text-neutral-100 font-mono">
        <main role="main">
            <div class="container max-w-4xl mx-auto px-4 sm:px-6 md:px-8">
<h1 class="text-4xl mt-20"><a href="https://zmudzinski.me">zmudzinski.me</a></h1>
<h2 class="text-sm text-neutral-500">I write Python code and do nerdy things.</h2>

<ul class="mt-5 flex space-x-4">
    <li><a class="underline" href="https://zmudzinski.me">Posts</a></li>
    <li><a class="underline" href="https://zmudzinski.me/pages/about">About</a></li>
    <li><a class="underline" href="https://zmudzinski.me/pages/projects">Projects</a></li>
    <li><a class="underline" href="https://zmudzinski.me/pages/family">Family</a></li>
</ul><article class="prose prose-invert font-mono max-w-4xl mt-20">
    <h1>Transform forward camera to top view</h1>
    <h2 class="text-sm text-neutral-500 -mt-6 mb-10">Created on: 2017.12.04</h2>
    <p>When dealing with robotics, we often get to a point, where we need to map our surroundings and localize the agent in the environment. If we equip our robot with a front facing camera, things get much easier. But this also creates a problem, of presenting the data we get as input in a way, that will become useful. Today I will present you how to transform the image we are getting from a camera mounted at the front of our robot, to a top view.</p>
<p>First of all we will be using Python 3 (since its already a couple of years old and most libraries are ported, so this IS what you should be using) and we need the following python modules to be installed:</p>
<ul>
<li><code>Numpy</code> – for making our life easier with numbers,</li>
<li><code>Matplotlib</code> – for displaying our data in a readable fashion,</li>
<li><code>OpenCV</code> – for dealing with transformations.</li>
</ul>
<h2>Making this work</h2>
<p>We will start by doing all the imports:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">img</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</code></pre></div>

<p>Now we will read the image and assign our source and destination points using <code>numpy</code>. This can be a bit tricky to get working. The numpy values for your source and destination arrays go as follows:</p>
<ul>
<li>bottom left -&gt; bottom right-&gt; top right -&gt; top left.</li>
</ul>
<p>We will display the image, so that you can read the points of a square meter from your image. Below in image_source you can see how I assigned my points and compare them to the previous image. The bigger the side value you set, the “lower” the camera will be.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Load the image from your camera</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;camera_image.jpg&#39;</span><span class="p">)</span>
<span class="c1"># Display the image to see points</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Values taken from my image</span>
<span class="n">image_source</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">600</span><span class="p">,</span><span class="mi">900</span><span class="p">],</span> <span class="c1"># bottom left</span>
    <span class="p">[</span><span class="mi">380</span><span class="p">,</span><span class="mi">1150</span><span class="p">],</span> <span class="c1"># bottom right</span>
    <span class="p">[</span><span class="mi">1220</span><span class="p">,</span><span class="mi">1150</span><span class="p">],</span> <span class="c1"># top right</span>
    <span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">900</span><span class="p">]</span> <span class="c1"># top left</span>
<span class="p">])</span>

<span class="c1"># Destination square size</span>
<span class="n">side</span> <span class="o">=</span> <span class="mi">120</span>
<span class="c1"># The destination to create a top view</span>
<span class="n">image_destination</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span>
 <span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">side</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> 
 <span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">side</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> 
 <span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">side</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">side</span><span class="p">],</span> 
 <span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">side</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">side</span><span class="p">]</span>
<span class="p">])</span>
</code></pre></div>

<p>Once we have that done, we will use OpenCV to do all the work for us. First we will get the perspective matrix using <code>cv2.getPerspectiveTransform()</code>, and then we will use <code>cv2.warpPerspective()</code> to warp our image into the top view output.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get our perspective matrix</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span>
   <span class="n">image_source</span><span class="p">,</span> 
   <span class="n">image_destination</span>
<span class="p">)</span>

<span class="c1"># Apply the matrix to the image</span>
<span class="n">warped</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span>
   <span class="n">image</span><span class="p">,</span> 
   <span class="n">M</span><span class="p">,</span> 
   <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="p">)</span>
</code></pre></div>
</article>
<footer class="mt-20 mb-20 text-sm text-neutral-500">
    <p>Site built with <a class="underline" href="https://getpelican.com/">Pelican</a> and hosted on <a class="underline" href="https://github.com/lukzmu/personal-website">GitHub</a>.</p>
    <p>&copy; 2026 zmudzinski.sh - from Poland with code.</p>
</footer>            </div>
        </main>
    </body>
</html>